<!DOCTYPE html>
<html>
  <head>
    <title>OpenCV.js Demo</title>
  </head>
  <body>
    <canvas id="imageCanvasInput" width="76" height="27"></canvas>
    <canvas id="canvasOutput" width="76" height="27"></canvas>
    <canvas id="templateCanvasInput" width="18" height="18"></canvas>
    <hr/>
    <button onclick="doIt()">Do it</button>
    <script src="https://docs.opencv.org/4.5.3/opencv.js"></script>
    <script>
      const loadImageToCanvas = (url, canvasId) => {
        let canvas = document.getElementById(canvasId);
        let ctx = canvas.getContext('2d');
        let img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;
            console.log(img.width);
            console.log(img.height);
            ctx.drawImage(img, 0, 0, img.width, img.height);
        };
        img.src = url;
      };

      loadImageToCanvas('window-buttons-1.5.png', 'imageCanvasInput');
      loadImageToCanvas('single-button.png', 'templateCanvasInput');

      function doIt() {
        console.log('doIt');
        let src = cv.imread('imageCanvasInput');
        let templ = cv.imread('templateCanvasInput');
        let dst = new cv.Mat();
        let mask = new cv.Mat();
        cv.matchTemplate(src, templ, dst, cv.TM_CCOEFF, mask);
        let result = cv.minMaxLoc(dst, mask);
        let maxPoint = result.maxLoc;
        let color = new cv.Scalar(255, 0, 0, 255);
        let point = new cv.Point(maxPoint.x + templ.cols, maxPoint.y + templ.rows);
        cv.rectangle(src, maxPoint, point, color, 2, cv.LINE_8, 0);
        cv.imshow('canvasOutput', src);
        src.delete(); 
        dst.delete(); 
        mask.delete();
      }
    </script>
  </body>
</html>
