<!DOCTYPE html>
<html>
  <head>
    <title>OpenCV.js Demo</title>
  </head>
  <body>
    <canvas id="canvasInput" width="81" height="31"></canvas>
    <canvas id="canvasOutput" width="81" height="31"></canvas>
    <hr/>
    <button onclick="doIt()">Do it</button>
    <script src="https://docs.opencv.org/4.5.3/opencv.js"></script>
    <script>
      const loadImageToCanvas = (url, cavansId) => {
        let canvas = document.getElementById(cavansId);
        let ctx = canvas.getContext('2d');
        let img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0, img.width, img.height);
        };
        img.src = url;
      };

      loadImageToCanvas('window-buttons.png', 'canvasInput');

      function doIt() {
        console.log('doIt');
        let src = cv.imread('canvasInput');
        let dst = cv.Mat.zeros(src.rows, src.cols, cv.CV_8U);
        let circles = new cv.Mat();
        let color = new cv.Scalar(255, 0, 0);
        cv.cvtColor(src, src, cv.COLOR_RGBA2GRAY, 0);
        // You can try more different parameters
        cv.HoughCircles(src, circles, cv.HOUGH_GRADIENT,
                        1, 5, 75, 40, 5, 10);
        // draw circles
        for (let i = 0; i < circles.cols; ++i) {
            let x = circles.data32F[i * 3];
            let y = circles.data32F[i * 3 + 1];
            let radius = circles.data32F[i * 3 + 2];
            let center = new cv.Point(x, y);
            cv.circle(dst, center, radius, color);
        }
        cv.imshow('canvasOutput', dst);
        src.delete(); 
        dst.delete(); 
        circles.delete();
      }
    </script>
  </body>
</html>
